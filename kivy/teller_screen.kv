#:import OneLineListItem kivymd.uix.list.OneLineListItem
#:import IconLeftWidget kivymd.uix.list.IconLeftWidget
<ReportItem@MDRippleBehavior+OneLineListItem>:

<TellerScreen>:
    on_enter: self.ids.screen_manager.current = "customers"
    MDNavigationLayout:
        MDScreenManager:
            id:screen_manager

            MDScreen:
                name: "customers"
                MDBoxLayout:
                    orientation: "vertical"
                    MDTopAppBar:
                        title: "Customer Management"
                        left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                    
                    MDBoxLayout:
                        orientation: "horizontal"
                        padding: dp(10)
                        spacing: dp(10)

                        # Left panel - Customer list
                        MDBoxLayout:
                            orientation: "vertical"
                            size_hint_x: 0.4
                            spacing: dp(10)

                            MDTextField:
                                id: search_field
                                hint_text: "Search customers..."
                                on_text: root.filter_customers(self.text)
                                size_hint_y: None
                                height: dp(48)

                            ScrollView:
                                MDList:
                                    id: customer_list

                            MDRaisedButton:
                                text: "Show Table"
                                size_hint_y: None
                                height: dp(48)
                                pos_hint: {"x": 0}
                                on_release: root.show_customer_table()

                        # Right panel - Customer details
                        MDBoxLayout:
                            orientation: "vertical"
                            spacing: dp(10)

                            MDCard:
                                size_hint_y: None
                                height: dp(200)
                                padding: dp(15)
                                spacing: dp(10)
                                orientation: "vertical"
                                
                                MDLabel:
                                    id: customer_name
                                    text: "Select a customer"
                                    font_style: "H5"
                                    halign: "left"
                                    theme_text_color: "Primary"
                                
                                MDLabel:
                                    id: customer_id
                                    text: ""
                                    font_style: "Subtitle2"

                                MDBoxLayout:
                                    MDLabel:
                                        text: "DOB: "
                                        size_hint_x: 0.3
                                    MDLabel:
                                        id: customer_dob
                                        text: ""

                                MDBoxLayout:
                                    MDLabel:
                                        text: "Phone: "
                                        size_hint_x: 0.3
                                    MDLabel:
                                        id: customer_phone
                                        text: ""
                                
                                MDBoxLayout:
                                    MDLabel:
                                        text: "Email: "
                                        size_hint_x: 0.3
                                    MDLabel:
                                        id: customer_email
                                        text: ""

                                MDBoxLayout:
                                    MDLabel:
                                        text: "Branch: "
                                        size_hint_x: 0.3
                                    MDLabel:
                                        id: customer_branch
                                        text: ""

                            MDLabel:
                                text: "Accounts"
                                font_style: "H6"
                                size_hint_y: None
                                height: dp(30)

                            ScrollView:
                                MDList:
                                    id: account_list

            MDScreen:
                name: "transactions"
                MDBoxLayout:
                    orientation: "vertical"
                    MDTopAppBar:
                        title: "Transactions"
                        left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                    MDLabel:
                        text: "Transactions content"
                        halign: "center"

            MDScreen:
                name: "branch_history"
                MDBoxLayout:
                    orientation: "vertical"
                    MDTopAppBar:
                        title: "Branch History"
                        left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                    MDLabel:
                        text: "Branch history content"
                        halign: "center"

            MDScreen:
                name: "reports"
                MDBoxLayout:
                    orientation: "vertical"

                    MDTopAppBar:
                        title: "Reports"
                        left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                        elevation: 4
                        adaptive_height: True # Để chiều cao tự động điều chỉnh

                    MDScrollView:
                        MDList:
                            OneLineListItem:
                                text: "Lịch sử giao dịch của chi nhánh"
                                on_release:
                                    app.root.get_screen("teller").call_report_procedure("sp_branch_transaction_history", app.db_cursor)
                                left_icon: "history" # Chọn icon phù hợp
                    
                             

                            OneLineListItem:
                                text: "Báo cáo tình nghi giao dịch"
                                on_release:
                                    app.root.get_screen("teller").call_report_procedure("sp_suspicious_transactions", app.db_cursor)
                                left_icon: "alert-octagon" # Chọn icon phù hợp
                            

                            OneLineListItem:
                                text: "Lịch sử hoạt động hệ thống"
                                on_release:
                                    app.root.get_screen("teller").call_report_procedure("sp_system_activity_log", app.db_cursor)
                                left_icon: "cog" # Chọn icon phù hợp
             

                            OneLineListItem:
                                text: "Tổng hợp tài khoản"
                                on_release:
                                    app.root.get_screen("teller").call_report_procedure("sp_account_summary", app.db_cursor)
                                left_icon: "file-document-multiple-outline" # Chọn icon phù hợp
                           

            MDScreen:
                name: "suspicion"
                MDBoxLayout:
                    orientation: "vertical"
                    MDTopAppBar:
                        title: "Suspicion"
                        left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                    MDLabel:
                        text: "Suspicion content"
                        halign: "center"

            MDScreen:
                name: "system_history"
                MDBoxLayout:
                    orientation: "vertical"
                    MDTopAppBar:
                        title: "System History"
                        left_action_items: [["menu", lambda x: nav_drawer.set_state("open")]]
                    MDLabel:
                        text: "System history content"
                        halign: "center"

        MDNavigationDrawer:
            id: nav_drawer
            radius: 0, dp(16), dp(16), 0
            MDNavigationDrawerMenu:

                MDNavigationDrawerHeader:
                    title: "Teller Panel"
                    title_color: "#4a4939"
                    spacing: "4dp"
                    padding: "16dp", "8dp", 0, "8dp"

                MDNavigationDrawerDivider:

                DrawerItem:
                    icon: "account-group"
                    text: "Customers"
                    on_release:
                        screen_manager.current = "customers"
                        nav_drawer.set_state("close")

                DrawerItem:
                    icon: "history"
                    text: "Transactions"
                    on_release:
                        screen_manager.current = "transactions"
                        nav_drawer.set_state("close")

                DrawerItem:
                    icon: "domain"
                    text: "Branch History"
                    on_release:
                        screen_manager.current = "branch_history"
                        nav_drawer.set_state("close")

                DrawerItem:
                    icon: "file-chart"
                    text: "Reports"
                    on_release:
                        screen_manager.current = "reports"
                        nav_drawer.set_state("close")

                DrawerItem:
                    icon: "account-alert"
                    text: "Suspicion"
                    on_release:
                        screen_manager.current = "suspicion"
                        nav_drawer.set_state("close")

                DrawerItem:
                    icon: "cog"
                    text: "System History"
                    on_release:
                        screen_manager.current = "system_history"
                        nav_drawer.set_state("close")

                MDNavigationDrawerDivider:
                    height: "1dp"

                DrawerItem:
                    icon: "arrow-left"
                    text: "Log Out"
                    on_release:
                        root.manager.transition.direction = "right"
                        root.manager.current = "main"